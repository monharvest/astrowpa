---
import Layout from '../../components/Layout.astro';
import SEO from '../../components/SEO.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map(post => ({
		params: { slug: post.slug }
	}));
}

const { slug } = Astro.params;
type BlogEntry = CollectionEntry<'blog'>;
const posts = (await getCollection('blog')) as BlogEntry[];
const post = posts.find((entry) => entry.slug === slug);

if (!post) {
	throw new Error(`Post with slug "${slug}" not found`);
}

const { Content } = await post.render();
const tags = post.data.tags ?? [];
---
<Layout title={`${post.data.title} - Astro PWA`} description={post.data.description}>
	<SEO
		title={post.data.title}
		description={post.data.description}
		image={post.data.image}
		url={`https://astro-pwa.example.com/posts/${post.slug}/`}
	/>
	<article class="space-y-6 rounded-2xl border border-slate-200 bg-white/90 p-6 shadow-card dark:border-slate-700 dark:bg-slate-900/70">
		<p class="text-sm uppercase tracking-wider text-brand-secondary">{post.data.category}</p>
		<h1 class="text-4xl font-bold leading-tight text-slate-900 dark:text-white">{post.data.title}</h1>
		<p class="text-sm text-slate-500 dark:text-slate-300">{post.data.date.toLocaleDateString()}</p>
		<img class="w-full rounded-xl" src={post.data.image} alt={post.data.title} width="1200" height="630" loading="lazy" />
		<div class="prose prose-slate max-w-none dark:prose-invert">
			<Content />
		</div>
		{tags.length > 0 && (
			<ul class="flex flex-wrap gap-3">
				{tags.map((tag) => (
					<li class="rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-500 dark:border-slate-600 dark:text-slate-300">
						{tag}
					</li>
				))}
			</ul>
		)}
	</article>
</Layout>
